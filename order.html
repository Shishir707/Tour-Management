<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Host Management</title>
  <link rel="shortcut icon" href="gallery/brhlLogo.jpeg" type="BRHL Logo">
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div id="order">
    <h2>T-Shirt Order</h2>
    <div style="overflow-x:auto">
    <table border="1" cellpadding="6" cellspacing="0">
    <thead>
      <tr>
        <th>Name</th>
        <th>Phone</th>
        <th>Hometown</th>
        <th>Size</th>
        <th>Payment</th>
        <th>Ref</th>
        <th>Collector</th>
        <th>xtr1</th>
        <th>xtr2</th>
        <th>xtr3</th>
        <th>xtr4</th>
        <th>Comment</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="orderTableBody"></tbody>
    </table>
   

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB5_LrlzM-okCEOcdUVHUK7brFfCZaADk0",
    authDomain: "t-shirt-3bee7.firebaseapp.com",
    databaseURL: "https://t-shirt-3bee7-default-rtdb.firebaseio.com",
    projectId: "t-shirt-3bee7",
    storageBucket: "t-shirt-3bee7.appspot.com",
    messagingSenderId: "537345037025",
    appId: "1:537345037025:web:293547ec53830e16559da0",
    measurementId: "G-PD5P7EL7N9"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const tableBody = document.getElementById("orderTableBody");

  onValue(ref(db, "extraTshirtOrders"), (snapshot) => {
    tableBody.innerHTML = "";

    snapshot.forEach((child) => {
      const data = child.val();
      const key = child.key;
      const status = data.status || "Pending";

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${data.name || ""}</td>
        <td>${data.phone || ""}</td>
        <td>${data.homeStation || ""}</td>
        <td>${data.tshirtSize || ""}</td>
        <td>${data.paymentMethod || ""}</td>
        <td>${data.reference || ""}</td>
        <td>${data.collector || ""}</td>
        <td>${data.extras?.extra1 || ""}</td>
        <td>${data.extras?.extra2 || ""}</td>
        <td>${data.extras?.extra3 || ""}</td>
        <td>${data.extras?.extra4 || ""}</td>
        <td>${data.comment || ""}</td>
        <td><span style="color:${status === "Pending" ? "red" : "green"}" id="status-${key}">${status}</span></td>
        <td>
          <button onclick="confirmOrder('${key}', this)">
            ${status === "Pending" ? "⏳ Pending" : "✅ Confirm"}
          </button>
        </td>
      `;
      tableBody.appendChild(row);
    });
  });

  window.confirmOrder = function (orderId, button) {
    const statusSpan = document.getElementById(`status-${orderId}`);
    const currentStatus = statusSpan.textContent.trim();
    const newStatus = currentStatus === "Pending" ? "Confirmed" : "Pending";

    update(ref(db, `extraTshirtOrders/${orderId}`), {
      status: newStatus
    }).then(() => {
      // Update UI
      statusSpan.textContent = newStatus;
      statusSpan.style.color = newStatus === "Pending" ? "green" : "red";
      button.textContent = newStatus === "Pending" ? "✅ Confirm" : "⏳ Pending";
    });
  };
</script>
</div>   
</body>
</html>